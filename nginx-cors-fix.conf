# Add this to your existing nginx server block for mapsy-widget.nextechspires.com

# CORS headers - Add these inside your server { } block
add_header Access-Control-Allow-Origin "*" always;
add_header Access-Control-Allow-Methods "GET, OPTIONS" always;
add_header Access-Control-Allow-Headers "Origin, X-Requested-With, Content-Type, Accept" always;

# Handle OPTIONS preflight requests
if ($request_method = 'OPTIONS') {
    add_header Access-Control-Allow-Origin "*";
    add_header Access-Control-Allow-Methods "GET, OPTIONS";
    add_header Access-Control-Allow-Headers "Origin, X-Requested-With, Content-Type, Accept";
    add_header Access-Control-Max-Age 86400;
    add_header Content-Length 0;
    add_header Content-Type "text/plain";
    return 204;
}

# Specific handling for manifest.json (no cache + CORS)
location = /manifest.json {
    add_header Cache-Control "no-cache, no-store, must-revalidate" always;
    add_header Pragma "no-cache" always;
    add_header Access-Control-Allow-Origin "*" always;
    try_files $uri =404;
}

# Cache control for loader (short cache)
location = /mapsy-widget-loader.js {
    add_header Cache-Control "public, max-age=300" always;
    add_header Access-Control-Allow-Origin "*" always;
    try_files $uri =404;
}

# Cache control for other JS/CSS files (long cache)
location ~* \.(js|css)$ {
    add_header Cache-Control "public, max-age=31536000" always;
    add_header Access-Control-Allow-Origin "*" always;
    try_files $uri =404;
}